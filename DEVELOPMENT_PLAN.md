# Loder - –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ collaborative room-based —Å–∏—Å—Ç–µ–º—ã

## –û–±–∑–æ—Ä

–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è Loder –∏–∑ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Claude –≤ collaborative room-based –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ—Ä–≤–µ—Ä (Python + SQLite –Ω–∞ kedicode)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: Flask/FastAPI
- **–ë–î**: SQLite
- **–ü—Ä–æ–∫—Å–∏**: Nginx
- **URL**: `https://loder.kedicode.com/api/v1`

### –ö–ª–∏–µ–Ω—Ç (macOS Swift)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: SwiftUI + AppKit
- **Networking**: URLSession
- **State**: ObservableObject

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –º–µ–Ω—é-–±–∞—Ä–∞

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ –ø–æ –∫–ª–∏–∫—É |
|-----------|-------------|-------------------|
| –ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω | üîë (–∫–ª—é—á) | –û—Ç–∫—Ä—ã—Ç—å popover, –∞–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| –õ–æ–±–±–∏ (–±–µ–∑ –∫–æ–º–Ω–∞—Ç—ã) | "zzz" | –û—Ç–∫—Ä—ã—Ç—å popover —Å –æ–ø—Ü–∏—è–º–∏ –∫–æ–º–Ω–∞—Ç—ã |
| –í –∫–æ–º–Ω–∞—Ç–µ (1-3 —é–∑–µ—Ä–∞) | 1-3 –∫—Ä—É–≥–ª—ã—Ö –∞–≤–∞—Ç–∞—Ä–∞ | –û—Ç–∫—Ä—ã—Ç—å popover —Å–æ —Å–ø–∏—Å–∫–æ–º |
| –í –∫–æ–º–Ω–∞—Ç–µ (4+ —é–∑–µ—Ä–æ–≤) | 3 –∞–≤–∞—Ç–∞—Ä–∞ + "+N" | –û—Ç–∫—Ä—ã—Ç—å popover —Å–æ —Å–ø–∏—Å–∫–æ–º |

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

```sql
CREATE TABLE users (
    id TEXT PRIMARY KEY,
    device_id TEXT UNIQUE NOT NULL,
    avatar_path TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE rooms (
    id TEXT PRIMARY KEY,  -- 7-char alphanumeric
    created_by TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

CREATE TABLE room_members (
    room_id TEXT NOT NULL,
    user_id TEXT NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    last_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (room_id, user_id)
);
```

---

## API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `POST /users/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ deviceId
- `POST /users/{id}/avatar` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ (multipart)
- `GET /users/{id}/avatar` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞

### –ö–æ–º–Ω–∞—Ç—ã
- `POST /rooms/create` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 7-char roomId)
- `POST /rooms/{id}/join` ‚Äî –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
- `POST /rooms/{id}/leave` ‚Äî –≤—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
- `GET /rooms/{id}` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ

### Heartbeat
- `POST /rooms/{id}/heartbeat` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ + –ø–æ–ª—É—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã)

```
Loder/
‚îú‚îÄ‚îÄ LoderApp.swift              # –ò–ó–ú–ï–ù–ò–¢–¨: NSPopover –≤–º–µ—Å—Ç–æ NSMenu
‚îú‚îÄ‚îÄ ClaudeActivityMonitor.swift # –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô
‚îÇ
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ User.swift
‚îÇ   ‚îú‚îÄ‚îÄ Room.swift
‚îÇ   ‚îî‚îÄ‚îÄ Participant.swift
‚îÇ
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ APIClient.swift         # HTTP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ UserService.swift       # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞–≤–∞—Ç–∞—Ä
‚îÇ   ‚îú‚îÄ‚îÄ RoomService.swift       # CRUD –∫–æ–º–Ω–∞—Ç
‚îÇ   ‚îî‚îÄ‚îÄ HeartbeatService.swift  # Polling –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
‚îÇ
‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îú‚îÄ‚îÄ PopoverContentView.swift
‚îÇ   ‚îú‚îÄ‚îÄ RegistrationView.swift
‚îÇ   ‚îú‚îÄ‚îÄ LobbyView.swift
‚îÇ   ‚îú‚îÄ‚îÄ RoomView.swift
‚îÇ   ‚îú‚îÄ‚îÄ AvatarUploadView.swift
‚îÇ   ‚îî‚îÄ‚îÄ AvatarStackView.swift
‚îÇ
‚îî‚îÄ‚îÄ Utilities/
    ‚îú‚îÄ‚îÄ DeviceIdentifier.swift  # Hardware UUID
    ‚îú‚îÄ‚îÄ ImageCache.swift
    ‚îî‚îÄ‚îÄ AppState.swift          # ObservableObject
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞

```
/root/loder-server/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ database.py
‚îú‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îî‚îÄ‚îÄ rooms.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ room_id.py
‚îî‚îÄ‚îÄ avatars/
```

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ —Ñ–∞–∑–∞–º)

### –§–∞–∑–∞ 1: –°–µ—Ä–≤–µ—Ä ‚Äî –ë–∞–∑–∞ (SSH kedicode)
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SQLite –∏ –º–æ–¥–µ–ª–∏
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/users/*` endpoints
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å curl'–æ–º

### –§–∞–∑–∞ 2: –°–µ—Ä–≤–µ—Ä ‚Äî –ö–æ–º–Ω–∞—Ç—ã
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/rooms/*` endpoints
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/rooms/{id}/heartbeat`
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx –ø—Ä–æ–∫—Å–∏
8. –î–µ–ø–ª–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–∑–∞ 3: –ö–ª–∏–µ–Ω—Ç ‚Äî –ú–æ–¥–µ–ª–∏ –∏ –°–µ—Ä–≤–∏—Å—ã
9. –°–æ–∑–¥–∞—Ç—å Models (User, Room, Participant)
10. –°–æ–∑–¥–∞—Ç—å DeviceIdentifier –∏ AppState
11. –°–æ–∑–¥–∞—Ç—å APIClient
12. –°–æ–∑–¥–∞—Ç—å UserService, RoomService, HeartbeatService

### –§–∞–∑–∞ 4: –ö–ª–∏–µ–Ω—Ç ‚Äî Popover UI
13. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å LoderApp.swift (NSPopover)
14. –°–æ–∑–¥–∞—Ç—å PopoverContentView
15. –°–æ–∑–¥–∞—Ç—å RegistrationView
16. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

### –§–∞–∑–∞ 5: –ö–ª–∏–µ–Ω—Ç ‚Äî –ö–æ–º–Ω–∞—Ç—ã
17. –°–æ–∑–¥–∞—Ç—å LobbyView
18. –°–æ–∑–¥–∞—Ç—å AvatarUploadView
19. –°–æ–∑–¥–∞—Ç—å RoomView
20. –°–æ–∑–¥–∞—Ç—å AvatarStackView –¥–ª—è –º–µ–Ω—é-–±–∞—Ä–∞

### –§–∞–∑–∞ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
21. –°–≤—è–∑–∞—Ç—å ClaudeActivityMonitor —Å HeartbeatService
22. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤
23. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∑–µ–ª—ë–Ω–∞—è —Ç–æ—á–∫–∞)
24. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

### –§–∞–∑–∞ 7: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
25. –û–±–Ω–æ–≤–∏—Ç—å Info.plist (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
26. –û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md
27. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ö–ª–∏–µ–Ω—Ç:**
- `/Users/admin/Developer/AppaWeek/Loder/Loder/LoderApp.swift` ‚Äî –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª, –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ UI

**–°–µ—Ä–≤–µ—Ä (—Å–æ–∑–¥–∞—Ç—å):**
- `/root/loder-server/app.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É Polling –∞ –Ω–µ WebSocket
- –ü—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- 5-—Å–µ–∫—É–Ω–¥–Ω—ã–π heartbeat –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –°–µ—Ä–≤–µ—Ä stateless (–ª–µ–≥—á–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å)

### Device ID
- –ò—Å–ø–æ–ª—å–∑—É–µ–º Hardware UUID —á–µ—Ä–µ–∑ IOKit
- Fallback: UUID –≤ UserDefaults

### –ê–≤–∞—Ç–∞—Ä—ã –≤ –º–µ–Ω—é-–±–∞—Ä–µ
- –†–µ–Ω–¥–µ—Ä–∏–º SwiftUI view –≤ NSImage
- –ö—ç—à–∏—Ä—É–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ

---

## –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

1. **–°–µ—Ä–≤–µ—Ä**: `curl -X POST .../users/register -d '{"deviceId":"test"}'`
2. **–ö–ª–∏–µ–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ó–∞–ø—É—Å–∫ ‚Üí –∫–ª—é—á–∏–∫ ‚Üí –∫–ª–∏–∫ ‚Üí –∞–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí "zzz"
3. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã**: –ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å" ‚Üí –ø–æ–ª—É—á–∏—Ç—å roomId
4. **–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –í–≤–µ—Å—Ç–∏ roomId –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Üí –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞
5. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ö–æ–≥–¥–∞ Claude –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –∑–µ–ª—ë–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–µ
